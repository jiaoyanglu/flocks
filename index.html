<html>
    <head>
        <script src="jquery-1.11.2.min.js"></script>
        <script src="flock.js"></script>
        <script>
        $(document).ready(function() {
            var fishPath = new Path2D('M 1.71 0.94 C 5.18 0.36 8.09 2.16 10.97 3.76 C 20.04 2.03 30.48 0.16 38.52 6.05 C 35.34 9.62 30.29 9.92 25.89 10.66 C 20.52 11.68 15.27 9.71 10.20 8.21 C 7.52 9.65 4.63 11.63 1.44 10.85 C 0.56 8.40 3.98 7.69 5.33 6.28 C 3.90 4.66 2.61 2.91 1.71 0.94 Z');
            var fishWidth = 50;
            var fishHeight = 15;

            var canvas = document.getElementById('pond-canvas');
            var context = canvas.getContext('2d');

            var school = flock(50);

            var toggle = true;
            $(canvas).click(function(evt) {
                if (toggle) {
                    school.seek(
                        evt.offsetX / canvas.width,
                        evt.offsetY / canvas.height,
                        5
                    );
                    school.gather(2, 500);
                } else {
                    school.flee(
                        evt.offsetX / canvas.width,
                        evt.offsetY / canvas.height,
                        5
                    );
                    school.scatter();
                }
                toggle = !toggle;
            });

            $(window).keypress(function(evt) {
                if (evt.which === 32) { // the spacebar
                    school.scatter();
                    return;
                }
                if (evt.which === 103) { // the 'g' key
                    school.gather();
                    return;
                }
                
            });
        
            
            requestAnimationFrame(frame);
            function frame() {
                school.tick(0.1);
                render();
                requestAnimationFrame(frame);
            }

            function render() {
                context.clearRect(0, 0, canvas.width, canvas.height);
                context.save();

                var bodies = school.bodies();
                for (var i = 0; i < bodies.length; i++) {
                    context.translate(    
                        bodies[i].x() * canvas.width,
                        bodies[i].y() * canvas.height
                    );
                    context.rotate(Math.atan2(bodies[i].vy(), bodies[i].vx()));
                    context.translate(-fishWidth/2, -fishHeight/2);
                    context.fill(fishPath);

                    context.restore();
                    context.save();
                }
            }
        });
        </script>
        <style>
            canvas {
                background: -webkit-linear-gradient(180deg, #F0C27B 10%, #4B1248 90%); /* Chrome 10+, Saf5.1+ */
                background:    -moz-linear-gradient(180deg, #F0C27B 10%, #4B1248 90%); /* FF3.6+ */
                background:     -ms-linear-gradient(180deg, #F0C27B 10%, #4B1248 90%); /* IE10 */
                background:      -o-linear-gradient(180deg, #F0C27B 10%, #4B1248 90%); /* Opera 11.10+ */
                background:         linear-gradient(180deg, #F0C27B 10%, #4B1248 90%); /* W3C */
            }
        </style>
    </head>
    <body>
        <canvas id="pond-canvas" width="700" height="700"></canvas>
        <audio src="dubadub.m4a" autoplay="true"></audio>
    </body>
</html>
